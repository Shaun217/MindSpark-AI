<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindSpark AI</title>
    <style>
        /* Dark Theme Styles */
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #0f172a; color: white; width: 360px; height: 500px; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        
        /* Header */
        header { background-color: #1e293b; padding: 1rem; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; z-index: 20; }
        h1 { margin: 0; font-size: 1.1rem; font-weight: 600; color: #818cf8; }
        .settings-btn { background: none; border: none; color: #94a3b8; cursor: pointer; font-size: 1.2rem; transition: color 0.2s; }
        .settings-btn:hover { color: #fff; }

        /* Main Chat Area */
        #chat-container { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; position: relative; }
        .msg { max-width: 85%; padding: 0.75rem; border-radius: 0.75rem; font-size: 0.9rem; line-height: 1.4; word-wrap: break-word; }
        .msg.user { align-self: flex-end; background-color: #4f46e5; color: white; border-bottom-right-radius: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .msg.model { align-self: flex-start; background-color: #1e293b; color: #e2e8f0; border: 1px solid #334155; border-top-left-radius: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .loading { color: #94a3b8; font-size: 0.8rem; text-align: center; margin-top: 10px; }

        /* Footer */
        footer { padding: 1rem; background-color: #1e293b; border-top: 1px solid #334155; display: flex; gap: 0.5rem; z-index: 20; }
        input[type="text"] { flex: 1; background-color: #0f172a; border: 1px solid #334155; color: white; padding: 0.75rem; border-radius: 0.5rem; outline: none; transition: border-color 0.2s; }
        input[type="text"]:focus { border-color: #6366f1; }
        button.send-btn { background-color: #4f46e5; border: none; color: white; padding: 0 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: bold; transition: background 0.2s; }
        button.send-btn:hover { background-color: #4338ca; }

        /* Settings View & Result Modal (Overlays) */
        .overlay-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #0f172a; z-index: 50; padding: 1.5rem; box-sizing: border-box; display: flex; flex-direction: column; }
        
        /* Result Modal Specifics */
        .result-card {
            background: #1e293b;
            border-radius: 1rem;
            border: 1px solid #334155;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        .result-header { padding: 1rem; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; background: #1e293b; }
        .result-title { font-weight: 600; color: #e2e8f0; font-size: 0.95rem; }
        .close-btn { background: none; border: none; color: #94a3b8; cursor: pointer; font-size: 1.2rem; }
        .result-body { flex: 1; padding: 0; position: relative; }
        .result-textarea { 
            width: 100%; height: 100%; 
            background: #0f172a; color: #e2e8f0; 
            border: none; padding: 1rem; 
            resize: none; outline: none; 
            font-family: inherit; font-size: 0.9rem; line-height: 1.5;
            box-sizing: border-box;
        }
        .result-footer { padding: 1rem; display: flex; gap: 0.5rem; border-top: 1px solid #334155; background: #1e293b; }
        .action-primary { flex: 1; background: #4f46e5; color: white; border: none; padding: 0.75rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .action-primary:hover { background: #4338ca; }
        .action-primary:active { transform: translateY(1px); }

        /* Settings Styles */
        label { display: block; margin-bottom: 0.5rem; color: #94a3b8; font-size: 0.9rem; }
        .save-btn { width: 100%; padding: 0.75rem; background-color: #4f46e5; color: white; border: none; border-radius: 0.5rem; font-weight: bold; cursor: pointer; margin-top: 1rem; }
        input[type="password"] { width: 100%; padding: 0.75rem; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 0.5rem; box-sizing: border-box; }

        /* Quick Actions Grid */
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.5rem; }
        .action-btn { 
            background-color: #1e293b; 
            border: 1px solid #334155; 
            color: #cbd5e1; 
            padding: 0.75rem; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            font-size: 0.85rem; 
            transition: all 0.2s; 
            display: flex; flex-direction: column; align-items: center; gap: 0.25rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .action-btn:hover { border-color: #6366f1; color: white; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(99, 102, 241, 0.2); }
        .action-icon { font-size: 1.2rem; margin-bottom: 2px; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>

    <!-- Result Modal (Overlay) -->
    <div id="result-modal" class="overlay-view hidden" style="padding: 1rem;">
        <div class="result-card">
            <div class="result-header">
                <span class="result-title" id="modal-title">Result</span>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="result-body">
                <textarea id="result-textarea" class="result-textarea" spellcheck="false"></textarea>
            </div>
            <div class="result-footer">
                <button id="copy-btn" class="action-primary">
                    <span>üìã</span> Copy
                </button>
            </div>
        </div>
    </div>

    <!-- Settings View -->
    <div id="settings-view" class="overlay-view hidden">
        <h2 style="margin-top:0; color: #818cf8;">Settings</h2>
        <p style="font-size: 0.8rem; color: #94a3b8; margin-bottom: 1rem;">Enter your Google Gemini API Key to enable AI features.</p>
        <div>
            <label>API Key</label>
            <input type="password" id="api-key-input" placeholder="AIzaSy...">
        </div>
        <button id="save-settings-btn" class="save-btn">Save Key</button>
        <button id="cancel-settings-btn" style="width: 100%; background:none; border:none; color:#94a3b8; padding:10px; cursor:pointer; margin-top: 5px;">Back</button>
    </div>

    <!-- Main App -->
    <header>
        <div class="flex items-center gap-2">
            <span>‚ú®</span>
            <h1>MindSpark AI</h1>
        </div>
        <button id="open-settings-btn" class="settings-btn">‚öôÔ∏è</button>
    </header>

    <div id="chat-container">
        <!-- Quick Actions -->
        <div class="actions-grid">
            <button class="action-btn" data-action="summarize_page">
                <span class="action-icon">üìù</span>
                Summarize Page
            </button>
            <button class="action-btn" data-action="explain_page">
                <span class="action-icon">ü§î</span>
                Explain Page
            </button>
            <button class="action-btn" data-action="fix_grammar">
                <span class="action-icon">‚úçÔ∏è</span>
                Fix Grammar
            </button>
            <button class="action-btn" data-action="translate">
                <span class="action-icon">üåê</span>
                Translate
            </button>
        </div>
        
        <div class="msg model">Hello! I'm MindSpark. Choose an action above or type below.</div>
    </div>

    <footer>
        <input type="text" id="user-input" placeholder="Ask anything...">
        <button id="send-btn" class="send-btn">Send</button>
    </footer>

    <script src="popup.js"></script>
</body>
</html>